
# üîπ Instalar software permitido (Windows)
- name: Instalar software permitido en el Game Center (Windows)
  ansible.windows.win_chocolatey:
    name: "{{ item }}"
    state: present
  loop: "{{ software_permitido }}"
  when: ansible_os_family == "Windows"

# üîπ Instalar software permitido (Linux)
- name: Instalar software permitido en Linux (Game Center)
  ansible.builtin.apt:
    name: "{{ item }}"
    state: present
  loop: "{{ software_permitido }}"
  when: ansible_os_family == "Debian"

# üîπ Instalar software permitido (macOS)
- name: Instalar software permitido en macOS (Game Center)
  community.general.homebrew:
    name: "{{ item }}"
    state: present
  loop: "{{ software_permitido }}"
  when: ansible_os_family == "Darwin"

# ======================================================
# ‚öôÔ∏è OPTIMIZACI√ìN Y RENDIMIENTO
# ======================================================

# üîπ Aumentar prioridad de rendimiento en Windows
- name: Ajustar plan de energ√≠a a alto rendimiento
  ansible.windows.win_power_plan:
    name: "High performance"
  when: ansible_os_family == "Windows"

# üîπ Deshabilitar servicios innecesarios en Windows (para juegos)
- name: Desactivar servicios no esenciales (Windows)
  ansible.windows.win_service:
    name: "{{ item }}"
    state: stopped
    start_mode: disabled
  loop:
    - SysMain        # Desfragmentaci√≥n en segundo plano
    - WSearch        # Indexado de Windows
    - DiagTrack      # Telemetr√≠a
  ignore_errors: yes
  when: ansible_os_family == "Windows"

# üîπ Optimizar el uso de CPU y RAM (Linux)
- name: Instalar herramientas de optimizaci√≥n y monitoreo (Linux)
  ansible.builtin.apt:
    name:
      - gamemode      # Optimiza rendimiento para gaming
      - mangohud      # Muestra FPS y estad√≠sticas
    state: present
  when: ansible_os_family == "Debian"

# ======================================================
# üåê POL√çTICAS DE USO Y RED
# ======================================================

# üîπ Configurar pol√≠tica de navegador (sin restricciones)
- name: Configurar navegador sin restricciones (Windows)
  ansible.windows.win_regedit:
    path: HKLM:\Software\Policies\Microsoft\Edge
    name: DownloadRestrictions
    data: 0   # 0 = descargas permitidas
    type: dword
  when:
    - ansible_os_family == "Windows"
    - politica_navegador == "abierto"

# üîπ Permitir acceso a tiendas y juegos (Linux)
- name: Permitir acceso a Steam y Epic Games (Linux)
  ansible.builtin.shell: |
    ufw allow 27015/tcp
    ufw allow 27036/tcp
    ufw allow 443/tcp
    ufw allow 80/tcp
  args:
    warn: false
  when: ansible_os_family == "Debian"

# ======================================================
# üéÆ PERSONALIZACI√ìN Y EXPERIENCIA DE USUARIO
# ======================================================

# üîπ Crear carpeta de juegos en escritorio
- name: Crear carpeta de juegos en escritorio (Windows)
  ansible.windows.win_file:
    path: "C:\\Users\\{{ nombre_usuario_salon }}\\Juegos"
    state: directory
  when: ansible_os_family == "Windows"

- name: Crear carpeta de juegos en escritorio (Linux)
  ansible.builtin.file:
    path: "/home/{{ nombre_usuario_salon }}/Juegos"
    state: directory
    mode: '0755'
  when: ansible_os_family == "Debian"

# üîπ Fondo de pantalla personalizado (Windows)
- name: Establecer fondo de pantalla del Game Center (Windows)
  ansible.windows.win_regedit:
    path: HKCU:\Control Panel\Desktop
    name: Wallpaper
    data: "C:\\Users\\Public\\Pictures\\game_center_wallpaper.jpg"
    type: string
  when: ansible_os_family == "Windows"

# üîπ Mensaje de bienvenida
- name: Mostrar mensaje de bienvenida (Windows)
  ansible.windows.win_regedit:
    path: HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\System
    name: legalnoticecaption
    data: "Bienvenido al Game Center"
    type: string
  when: ansible_os_family == "Windows"

- name: Mostrar mensaje de bienvenida (Windows) - texto
  ansible.windows.win_regedit:
    path: HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\System
    name: legalnoticetext
    data: "Este equipo est√° configurado para uso recreativo y educativo. Disfruta responsablemente."
    type: string
  when: ansible_os_family == "Windows"

# ======================================================
# üßπ MANTENIMIENTO AUTOM√ÅTICO
# ======================================================

# üîπ Tarea programada para limpiar temporales (Windows)
- name: Programar limpieza semanal de temporales (Windows)
  ansible.windows.win_scheduled_task:
    name: "LimpiezaGameCenter"
    actions:
      - path: "powershell.exe"
        arguments: "-Command Remove-Item 'C:\\Windows\\Temp\\*' -Recurse -Force"
    triggers:
      - schedule: weekly
        days_of_week: Sunday
        start_boundary: '2025-01-01T03:00:00'
    state: present
  when: ansible_os_family == "Windows"

# üîπ Limpieza en Linux
- name: Limpiar temporales y cach√© de juegos (Linux)
  ansible.builtin.command: rm -rf /home/{{ nombre_usuario_salon }}/.cache/*
  ignore_errors: yes
  when: ansible_os_family == "Debian"
