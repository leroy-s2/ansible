
# üîπ Instalar software permitido (Windows)
- name: Instalar software permitido en el Laboratorio Acad√©mico (Windows)
  ansible.windows.win_chocolatey:
    name: "{{ item }}"
    state: present
  loop: "{{ software_permitido }}"
  when: ansible_os_family == "Windows"

# üîπ Instalar software permitido (Linux)
- name: Instalar software permitido en Linux (Laboratorio Acad√©mico)
  ansible.builtin.apt:
    name: "{{ item }}"
    state: present
  loop: "{{ software_permitido }}"
  when: ansible_os_family == "Debian"

# üîπ Instalar software permitido (macOS)
- name: Instalar software permitido en macOS (Laboratorio Acad√©mico)
  community.general.homebrew:
    name: "{{ item }}"
    state: present
  loop: "{{ software_permitido }}"
  when: ansible_os_family == "Darwin"

# ======================================================
# üîí RESTRICCIONES Y POL√çTICAS
# ======================================================

# üîπ Configurar pol√≠tica de navegador (bloquear descargas)
- name: Configurar pol√≠tica del navegador (Windows)
  ansible.windows.win_regedit:
    path: HKLM:\Software\Policies\Microsoft\Edge
    name: DownloadRestrictions
    data: 3   # 3 = Bloquear todas las descargas
    type: dword
  when:
    - ansible_os_family == "Windows"
    - politica_navegador == "restringido"

# üîπ Configurar pol√≠tica de navegador (Linux)
- name: Bloquear descargas en Firefox (Linux)
  ansible.builtin.lineinfile:
    path: /etc/firefox/firefox.js
    regexp: '^user_pref\("browser.download'
    line: 'user_pref("browser.download.folderList", 2);'
    create: yes
  when:
    - ansible_os_family == "Debian"
    - politica_navegador == "restringido"

# üîπ Limitar privilegios de usuario (Linux)
- name: Eliminar privilegios de sudo al usuario del sal√≥n
  ansible.builtin.lineinfile:
    path: /etc/sudoers
    regexp: '^{{ nombre_usuario_salon }}'
    state: absent
  when:
    - ansible_os_family == "Debian"

# üîπ Crear carpeta acad√©mica compartida (para documentos)
- name: Crear carpeta acad√©mica en escritorio (Linux)
  ansible.builtin.file:
    path: "/home/{{ nombre_usuario_salon }}/Documentos_Academicos"
    state: directory
    mode: '0755'
  when: ansible_os_family == "Debian"

- name: Crear carpeta acad√©mica en escritorio (Windows)
  ansible.windows.win_file:
    path: "C:\\Users\\{{ nombre_usuario_salon }}\\Documentos_Academicos"
    state: directory
  when: ansible_os_family == "Windows"

# üîπ Mensaje de bienvenida institucional
- name: Mostrar mensaje institucional al iniciar sesi√≥n (Windows)
  ansible.windows.win_regedit:
    path: HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\System
    name: legalnoticecaption
    data: "Bienvenido al Laboratorio Acad√©mico"
    type: string
  when: ansible_os_family == "Windows"

- name: Mostrar mensaje institucional al iniciar sesi√≥n (Windows) - texto
  ansible.windows.win_regedit:
    path: HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\System
    name: legalnoticetext
    data: "Este equipo pertenece al Laboratorio Acad√©mico. Uso exclusivo para fines educativos. El acceso no autorizado est√° prohibido."
    type: string
  when: ansible_os_family == "Windows"
